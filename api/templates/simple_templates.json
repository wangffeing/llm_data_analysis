{
  "customer_satisfaction_deepdive": {
    "template_metadata": {
      "id": "customer_satisfaction_deepdive",
      "name": "客户满意度深度分析",
      "summary": "只需提供客户评分和日期，即可自动分析满意度现状、追踪历史趋势、并定位问题维度。本模板专为产品经理和客户体验负责人设计，助您快速发现改进机会。"
    },
    "data_schema": {
      "required_columns": [
        {
          "name": "satisfaction_score",
          "type": "numeric",
          "description": "客户满意度评分，必须为数值型。"
        },
        {
          "name": "date",
          "type": "datetime",
          "description": "评分提交的日期或时间戳，用于趋势分析。"
        }
      ],
      "optional_columns": [
        {
          "name": "category",
          "type": "string",
          "description": "进行评分的产品、服务或业务类别（例如：'售后支持', '产品功能', '物流速度'）。"
        },
        {
          "name": "segment",
          "type": "string",
          "description": "客户细分维度（例如：客户所在地区'region', 客户等级'tier', 使用套餐'plan'）。"
        }
      ]
    },
    "execution_plan": {
      "analysis_goal": "精准评估当前客户满意度整体水平，识别其随时间的变化模式，并定位表现不佳的关键客户群体或产品/服务类别，为优化决策提供数据支持。",
      "steps": [
        {
          "prompt": "1. 数据验证与预处理：加载数据集。首先，严格验证必需列`satisfaction_score`和`date`是否存在且数据类型正确。检查`satisfaction_score`列的值是否在合理的范围（例如1到10之间），超出范围的值视为异常并报告。将`date`列转换为标准的日期时间格式。处理缺失值（如有），并报告处理方式和比例。",
          "save_to_variable": "cleaned_df"
        },
        {
          "prompt": "2. 总体满意度评估：计算`satisfaction_score`的整体描述性统计数据，包括：总评分数、均值、中位数、标准差、最小值和最大值。然后，将满意度评分分为三个等级：低分(1-6)，中等(7-8)，高分(9-10)，并计算每个等级的占比。",
          "save_to_variable": "overall_metrics"
        },
        {
          "prompt": "3. 满意度分布可视化：生成两个图表：1. 一个直方图，展示`satisfaction_score`的整体分布情况。2. 一个条形图，精确显示从1到10每个具体分数的数量，以便观察是否存在极端评分集中的现象。",
          "save_to_variable": "score_distribution_data"
        },
        {
          "prompt": "4. 满意度趋势分析：按月度聚合数据，计算每个月的平均`satisfaction_score`。生成一个折线图，清晰地展示满意度随时间的变化趋势，并在图中标示出均值线。",
          "save_to_variable": "trend_analysis_results"
        },
        {
          "prompt": "5. (条件性) 多维度下钻分析：如果数据中存在`category`或`segment`列：对每个类别/分段进行分组，计算其平均满意度和评分总数。将结果以表格形式展示，并按平均满意度从低到高排序，以快速定位表现最差和最好的维度。",
          "save_to_variable": "segment_comparison_table"
        },
        {
          "prompt": "6. 总结与洞察生成：综合所有已生成的变量 `overall_metrics`, `trend_analysis_results`, `segment_comparison_table` (如果存在)，使用 `output_specification.insights_template` 格式，生成一份结构化的分析摘要。确保所有占位符都被填充。"
        }
      ]
    },
    "output_specification": {
      "insights_template": "## 客户满意度分析报告\n\n**1. 核心发现:**\n   - **总体情况:** 本次分析共包含 **{total_count}** 条评分。整体平均满意度为 **{mean_score:.2f}** 分。\n   - **趋势变化:** 从时间趋势上看，客户满意度呈现 **{trend_description}** 的趋势。\n   - **维度洞察:** [如果进行了下钻分析] 在所有维度中，**'{worst_segment_name}'** 的表现最差，其平均满意度仅为 **{worst_segment_score:.2f}** 分。\n\n**2. 结论与建议:**\n   - **结论:** 目前客户满意度处于 **{overall_evaluation}** 水平。主要挑战在于 **{main_challenge_description}**。\n   - **建议:** 建议针对 **'{worst_segment_name}'** 维度进行根本原因分析，并投入资源进行优化改进。",
      "files": [
        {
          "type": "histogram",
          "title": "客户满意度分数分布",
          "source_variable": "cleaned_df",
          "tool": "seaborn"
        },
        {
          "type": "bar",
          "title": "各满意度分数计数",
          "source_variable": "score_distribution_data",
          "tool": "gpt_vis_chart"
        },
        {
          "type": "line",
          "title": "客户满意度月度趋势",
          "source_variable": "trend_analysis_results",
          "tool": "gpt_vis_chart"
        },
        {
          "type": "csv",
          "title": "各维度满意度对比表",
          "source_variable": "segment_comparison_table",
          "tool": "pandas"
        }
      ]
    }
  },
  "complaint_kanban_analysis": {
    "template_metadata": {
      "id": "complaint_kanban_analysis",
      "name": "投诉看板深度分析",
      "summary": "基于河北省移动公司每日投诉统计数据，自动分析投诉分布、关键服务指标趋势及问题路径表现，帮助管理者快速定位服务薄弱环节并制定改进策略。"
    },
    "data_schema": {
      "required_columns": [
        {
          "name": "STATIS_DATE",
          "type": "string",
          "description": "统计日期，格式为 yyyymmdd 字符串"
        },
        {
          "name": "CATALOG_ONE",
          "type": "string",
          "description": "客户投诉或咨询的一级业务路径（如：资费争议、网络故障、办理流程等），用于归因分析。"
        },
        {
          "name": "WRKFM_COUNT",
          "type": "numeric",
          "description": "工单量，代表该路径下的投诉总量或处理请求数量。"
        },
        {
          "name": "ONCE_SOLVED_NUM",
          "type": "numeric",
          "description": "一解率分子，表示一次解决的工单数量。"
        },
        {
          "name": "ZX_MYD",
          "type": "numeric",
          "description": "咨询满意度，范围通常为0-100，表示客户对咨询服务的满意程度。"
        },
        {
          "name": "WTJJ_MYD",
          "type": "numeric",
          "description": "问题解决满意度，范围通常为0-100，反映问题最终解决后的客户评价."
        },
        {
          "name": "DATE_TYPE",
          "type": "string",
          "description": "日期类型，取值为['日', '周', '日累计']，用于过滤和分组分析。建议使用'日'级别数据进行趋势分析。"
        }
      ],
      "optional_columns": [
        {
          "name": "CALL_DURATION",
          "type": "numeric",
          "description": "通话均长（秒），反映客服交互深度。"
        },
        {
          "name": "CLICK_NUM",
          "type": "numeric",
          "description": "线上渠道点击量，可用于对比服务渠道热度。"
        }
      ]
    },
    "execution_plan": {
      "analysis_goal": "基于河北省移动公司每日投诉统计数据，系统评估近期客户投诉的整体规模、服务解决效率（一解率）及满意度水平（咨询与问题解决），识别关键指标的时间趋势与异常波动；同时按一级业务路径（CATALOG_ONE）进行下钻分析，定位投诉量最高、满意度最低的突出问题领域，为服务优化提供数据支持。",
      "steps": [
        {
          "prompt": "1.数据提取与验证：从数据库表 'tb_rp_ct_knba_analyse_kanban_day' 中加载数据。默认取最近30天的数据（STATIS_DATE >= 当前日期-30天），且 DATE_TYPE = '日'。查询字段包括'必需列'。将 STATIS_DATE 从 yyyymmdd 字符串转换为 datetime 类型。对数值列强制转换为数值类型（float 或 int），无法转换的变为 NaN，同时处理缺失值和异常值来避免数据中有空值、非数字字符的问题。",
          "save_to_variable": "daily_df"
        },
        {
          "prompt": "2.指标计算与趋势分析：在 daily_df 基础上，(1) 计算一解率 ONCE_SOLVED_RATE = ONCE_SOLVED_NUM / WRKFM_COUNT（限制在0~1）；(2) 按 STATIS_DATE 聚合，计算每日总工单量、平均一解率、平均咨询满意度和问题解决满意度；(3) 生成多子图趋势图：日工单量、一解率、两个满意度指标的变化趋势。",
          "save_to_variable": "trend_analysis"
        },
        {
          "prompt": "3.问题路径下钻分析：按 CATALOG_ONE 分组，计算各路径的总工单量、平均一解率、平均 ZX_MYD 和 WTJJ_MYD。然后：(1) 按工单量降序排序，提取投诉最集中的前10个路径；(2) 按 WTJJ_MYD 升序排序，找出满意度最低的前5个路径。将结果整合为一个综合分析表。",
          "save_to_variable": "path_insights"
        },
        {
          "prompt": "4. 综合洞察生成：结合 trend_analysis 和 path_insights，提取关键指标：平均日工单量、峰值负荷、平均一解率、满意度趋势、最高频路径、最低满意度路径等，构造上下文字典，用于填充最终报告。",
          "save_to_variable": "insights_context"
        }
      ]
    },
    "output_specification": {
      "insights_template": "## 投诉看板分析报告\n\n**1. 核心发现:**\n\t- **整体负荷:** 近期日均工单量约为 **{}** 件，最高单日达 **{}** 件，服务压力处于 **{}** 水平。   \n\t- **解决效率:** 平均一解率为 **{}**，表现 **{}**。\n\t- **满意度水平:** 问题解决满意度（WTJJ_MYD）平均为 **{}** 分，近期呈 **{}** 趋势。\n\t- **重点问题路径:** 投诉最集中的业务路径是 **'{}'**，客户体验最差的路径是 **'{}'**。\n\t\n**2. 结论与建议:**\n\t- **结论:** 当前服务资源主要集中在 **{}** 等高频路径，且 **{}** 存在明显体验短板。\n\t- **建议:** 建议对 **'{}'** 和 **'{}'** 开展根因分析，优化处理流程、加强一线培训或推动系统改造，提升首次解决率与客户满意度。\n",
      "files": [
        {
          "type": "chart",
          "title": "日工单量与服务指标趋势",
          "source_variable": "trend_analysis",
          "tool": "gpt_vis_chart"
        },
        {
          "title": "各一级路径工单分布（Top 10）",
          "type": "chart",
          "source_variable": "path_insights",
          "tool": "gpt_vis_chart"
        },
        {
          "title": "问题解决满意度最低的 Top 5 路径",
          "source_variable": "path_insights",
          "type": "chart",
          "tool": "gpt_vis_chart"
        },
        {
          "title": "各一级路径服务表现汇总表",
          "type": "table",
          "source_variable": "path_insights",
          "tool": "pandas"
        }
      ]
    }
  },
  "staff_efficiency_analysis": {
    "template_metadata": {
      "id": "staff_efficiency_analysis",
      "name": "86热线员工效能深度分析",
      "summary": "基于86热线员工日累计效能数据，系统评估员工工作负荷、通话效率、利用率与解决能力，识别高绩效与低效能个体/团队，为人员管理、排班优化与服务质量提升提供数据支持。"
    },
    "data_schema": {
      "required_columns": [
        { "name": "statis_date", "type": "string", "description": "统计日期，格式为 yyyy-mm-dd 或 yyyymmdd" },
        { "name": "staff_id", "type": "string", "description": "员工唯一编号，用于个体追踪" },
        { "name": "staff_name", "type": "string", "description": "员工姓名" },
        { "name": "team_desc", "type": "string", "description": "班组名称，用于团队级分析" },
        { "name": "team_path", "type": "string", "description": "团队路径（如：河北->石家庄->高新一班），支持层级分析" },
        { "name": "call_used_rate", "type": "numeric", "description": "通话利用率（%），反映坐席在岗期间用于通话的时间占比，目标值通常≥85%" },
        { "name": "eff_work_rate", "type": "numeric", "description": "在线利用率（%），衡量有效工作时长占签入时长的比例" },
        { "name": "once_solved_rate", "type": "numeric", "description": "一次解决率（%），体现服务质量和客户体验，关键质量指标" },
        { "name": "opma_ontime_rate", "type": "numeric", "description": "排班遵时率（%），反映员工按时签入情况，影响服务供给稳定性" },
        { "name": "talk_duration", "type": "numeric", "description": "人工通话时长（秒），反映服务交互深度" },
        { "name": "work_logon_duration", "type": "numeric", "description": "签入系统时长（秒），衡量实际在岗时间" }
      ],
      "optional_columns": [
        { "name": "prov_name", "type": "string", "description": "话务归属省份" },
        { "name": "bl_prov_name", "type": "string", "description": "人员归属省份" },
        { "name": "staff_type_name", "type": "string", "description": "人员类型（自有/众包）" },
        { "name": "outer_name", "type": "string", "description": "众包公司名称" },
        { "name": "post_type", "type": "string", "description": "岗位类型" },
        { "name": "entry_duration", "type": "numeric", "description": "入职时长（天或月），可用于新老员工对比" }
      ]
    },
    "execution_plan": {
      "analysis_goal": "全面评估86热线员工的工作投入度、服务效率与质量表现，分析关键效能指标（如通话利用率、一次解决率、排班遵时率）的整体水平与分布差异；按员工、班组、团队等维度下钻，定位表现最优与最差的群体，识别资源错配或管理短板，提出可落地的优化建议。",
      "steps": [
        {
          "prompt": "1. 数据提取与验证：从表 'tb_rp_ct_86hl_staff_index_summ_dtal' 中提取最近7天或指定时间段的数据（默认 statis_date >= 当前日期-7天）。检查字段完整性，将 statis_date 转为 datetime 类型，数值字段转为 float 并处理异常值（如利用率 >100% 或 <0）。过滤掉 staff_id 为空的记录。",
          "save_to_variable": "daily_df"
        },
        {
          "prompt": "2. 指标计算与清洗：在 daily_df 基础上，(1) 计算人均指标：平均通话利用率、平均在线利用率、平均一次解决率、平均排班遵时率；(2) 标记异常员工：如 call_used_rate < 70% 或 >95%（过低表示效率差，过高可能疲劳作业）；(3) 计算通话效率比：talk_duration / work_logon_duration。",
          "save_to_variable": "processed_df"
        },
        {
          "prompt": "3. 团队与班组效能分析：按 team_desc 和 team_path 分组，计算各团队的平均通话利用率、平均一次解决率、平均排班遵时率、员工数量。识别表现最优（Top 5）和最差（Bottom 5）的班组。",
          "save_to_variable": "team_insights"
        },
        {
          "prompt": "4. 个体员工表现下钻：按 staff_id 聚合，计算每位员工的平均关键指标。提取：(1) 绩效最优 Top 10 员工（综合 call_used_rate + once_solved_rate）；(2) 低效能 Bottom 10 员工（call_used_rate 低且 free_rate 高）；(3) 出勤异常员工（opma_ontime_rate < 80%）。",
          "save_to_variable": "staff_insights"
        },
        {
          "prompt": "5. 综合洞察生成：结合 processed_df、team_insights 和 staff_insights，构造 insights_context 字典，包含：avg_call_used_rate, workload_level, top_team, worst_team, top_performer, worst_performer, ontime_rate_issue_count。Planner 必须亲自撰写报告，不得直接使用 Worker 输出。报告结构应为：## 概述 → ## 关键发现 → ## 详细分析 → ## 建议措施。",
          "save_to_variable": "insights_context"
        }
      ]
    },
    "output_specification": {
      "insights_template": "## 86热线员工效能分析报告\n\n### 概述\n本报告基于近7天86热线员工效能数据，对通话利用率、一次解决率、排班遵时率等核心指标进行系统分析，旨在识别高绩效团队与低效能个体，为人力资源优化与服务质量提升提供决策依据。\n\n### 关键发现\n- **整体效能:** 员工平均通话利用率为 **{avg_call_used_rate:.1f}%**，处于 **{utilization_level}** 水平；平均一次解决率为 **{avg_once_solved_rate:.1f}%**，表现 **{resolution_eval}**。\n- **出勤表现:** 平均排班遵时率为 **{avg_ontime_rate:.1f}%**，有 **{ontime_rate_issue_count}** 名员工低于80%，存在出勤管理风险。\n- **最佳团队:** 表现最优的班组是 **'{top_team}'**，其综合效能领先。\n- **待改进团队:** 表现最差的班组是 **'{worst_team}'**，需重点关注。\n- **标杆员工:** 绩效最优员工为 **'{top_performer}'**。\n- **需帮扶员工:** 效能最低员工为 **'{worst_performer}'**，建议介入辅导。\n\n### 详细分析\n结合团队与个体表现，发现：\n- 高效能团队 **'{top_team}'** 在通话利用率与一次解决率上均表现突出，可提炼其管理经验进行推广。\n- 低效能团队 **'{worst_team}'** 存在空闲率高、示忙时长占比大等问题，可能存在流程卡点或培训不足。\n- 员工 **'{worst_performer}'** 虽签入时长不短，但通话利用率低，建议核查其工作状态或任务分配。\n\n### 建议措施\n1. **标杆推广：** 对 **'{top_team}'** 开展经验复盘，提炼高效管理模式并在全团队推广。\n2. **精准帮扶：** 对 **'{worst_performer}'** 及其所在班组进行一对一辅导，分析低效原因。\n3. **排班优化：** 对排班遵时率低的 **{ontime_rate_issue_count}** 名员工进行提醒或规则强化。\n4. **激励机制：** 建立基于‘通话利用率+一次解决率’的综合绩效奖励机制，引导良性竞争。",
      "files": [
        {
          "type": "chart",
          "title": "各班组平均通话利用率与一次解决率",
          "source_variable": "team_insights",
          "tool": "gpt_vis_chart"
        },
        {
          "title": "员工通话利用率分布",
          "type": "chart",
          "source_variable": "processed_df",
          "tool": "seaborn"
        },
        {
          "title": "各班组效能汇总表",
          "source_variable": "team_insights",
          "type": "table",
          "tool": "pandas"
        }
      ]
    }
  }
}